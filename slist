#!/bin/bash

ROOTDIR="src"

#Use for recongizing submodules.
IDENTITY="makefile"

SUBMODULEDIR=$(dirname $(find $ROOTDIR \( -path *.git \) -a -prune -o -name $IDENTITY -a -not -path $ROOTDIR -printf "%p ") | xargs echo)
SUBMODULELOC=$(dirname $(find $ROOTDIR \( -path *.git \) -a -prune -o -name $IDENTITY -a -not -path $ROOTDIR -printf "%p ") | xargs -i echo -L{} | xargs echo)
SUBMODULE=$(basename -a $(dirname `find $ROOTDIR \( -path *.git \) -a -prune -o -name $IDENTITY -a -not -path $ROOTDIR -print`) | xargs -i echo -l{} | xargs echo)

if [[ -n "$SUBMODULEDIR" ]]; then
	SUBDIR="-path ${SUBMODULEDIR// / -o -path }"
	echo "SUBDIR = $SUBDIR" > sourcelist
fi

if [[ -z "$SUBDIR" ]]; then
	echo -e "SOURCE = $(find $ROOTDIR -name "*.cpp" -printf "%f "|xargs echo)" > sourcelist

	echo -e "SOURCEPATH = $(find $ROOTDIR -name "*.cpp" -print|xargs echo)" >> sourcelist
else
	echo -e "SOURCE = $(find $ROOTDIR \( $SUBDIR \) \
		-a -prune -o -name "*.cpp" -printf "%f "|xargs echo)" >> sourcelist

	echo -e "SOURCEPATH = $(find $ROOTDIR \( $SUBDIR \) \
		-a -prune -o -name "*.cpp" -print|xargs echo)" >> sourcelist
fi

# echo -e "DIR =  `dirname $(find $ROOTDIR -name "*.cpp" -printf "%P ") | sort | uniq | xargs echo`" >> sourcelist

echo -e "SUBMODULEDIR = $SUBMODULEDIR" >> sourcelist
echo -e "SUBMODULELOC = $SUBMODULELOC" >> sourcelist
echo -e "SUBMODULE = $SUBMODULE" >> sourcelist

